<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0; /* ğŸ”¹ Ø´ÙŠÙ„Ù†Ø§ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ */
      display: flex;
    }

    /* Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
    .content {
      flex: 1;
      padding: 20px;  /* ğŸ”¹ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ Ù‡Ù†Ø§ Ø¨Ø¯Ù„ body */
      margin-right: 60px;
      transition: margin-right 0.3s ease;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 15px;
    }

    .search-box {
      text-align: center;
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    select, input {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
    }
    input {
      width: 250px;
    }

    /* ğŸ”¹ Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù€ Kanban */
    .dashboard {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding-bottom: 15px;
    }
    .branch-card {
      background: #e9f1fb;
      border-radius: 15px;
      padding: 15px;
      min-width: 280px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .branch-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
      color: #fff;
      background: #2f80ed;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .stat {
      font-size: 13px;
      padding: 5px 10px;
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
    }
    .open { background: #e74c3c; }
    .closed { background: #27ae60; }

    .complaints-list {
      flex-grow: 1;
      overflow-y: auto;
      margin-top: 10px;
      padding-right: 5px;
    }

    .complaint {
      background: #fff;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 10px;
      font-size: 14px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.08);
    }
    .complaint .status {
      font-weight: bold;
      font-size: 13px;
      padding: 3px 7px;
      border-radius: 6px;
      display: inline-block;
      margin-top: 5px;
    }
    .complaint.open .status { background: #fdecea; color: #e74c3c; }
    .complaint.closed .status { background: #eafaf1; color: #27ae60; }
  </style>
</head>
<body>
  <!-- Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± -->
  <div id="sidebar"></div>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
  <div class="content">
    <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ</h1>

    <div class="search-box">
      <select id="searchType">
        <option value="name">Ø§Ù„Ø§Ø³Ù…</option>
        <option value="order">Ø±Ù‚Ù… Ø§Ù„Ø£ÙˆØ±Ø¯Ø±</option>
        <option value="phone">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</option>
      </select>
      <input type="text" id="searchInput" placeholder="ğŸ” Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ù„Ù„Ø¨Ø­Ø«...">
    </div>

    <div class="dashboard" id="dashboard"></div>
  </div>

  <script>
    // Ù…Ø«Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† LocalStorage
    const complaints = JSON.parse(localStorage.getItem("complaints")) || [];

    function renderDashboard(searchType = "", filterText = "") {
      const dashboard = document.getElementById("dashboard");
      dashboard.innerHTML = ""; 

      // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ø¹
      const branches = {};
      complaints.forEach(c => {
        if(!branches[c.branch]) branches[c.branch] = [];
        branches[c.branch].push(c);
      });

      for(const branch in branches){
        let branchComplaints = branches[branch];

        // Ø§Ù„ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
        if(filterText){
          branchComplaints = branchComplaints.filter(c => {
            if(searchType === "name") return c.name.includes(filterText);
            if(searchType === "order") return (c.id+"").includes(filterText);
            if(searchType === "phone") return c.phone.includes(filterText);
            return true;
          });
        }

        if(branchComplaints.length === 0) continue;

        const openCount = branchComplaints.filter(c => c.status === "Ù…ÙØªÙˆØ­Ø©").length;
        const closedCount = branchComplaints.filter(c => c.status === "ØªÙ… Ø§Ù„Ø­Ù„").length;

        const card = document.createElement("div");
        card.className = "branch-card";

        card.innerHTML = `
          <div class="branch-title">${branch}</div>
          <div class="stats">
            <div class="stat open">Ù…ÙØªÙˆØ­Ø©: ${openCount}</div>
            <div class="stat closed">ØªÙ… Ø§Ù„Ø­Ù„: ${closedCount}</div>
          </div>
          <div class="complaints-list">
            ${branchComplaints.map(c => `
              <div class="complaint ${c.status === "Ù…ÙØªÙˆØ­Ø©" ? "open" : "closed"}">
                <div>ğŸ†” Ø£ÙˆØ±Ø¯Ø± #${c.id}</div>
                <div>ğŸ‘¤ ${c.name} - ğŸ“ ${c.phone}</div>
                <div>ğŸ“ ${c.details}</div>
                <div class="status">${c.status}</div>
                <small>â° ${c.date}</small>
              </div>
            `).join("")}
          </div>
        `;

        dashboard.appendChild(card);
      }
    }

    // Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
    renderDashboard();

    // Ø§Ù„Ø¨Ø­Ø«
    const searchInput = document.getElementById("searchInput");
    const searchType = document.getElementById("searchType");

    searchInput.addEventListener("input", function(){
      renderDashboard(searchType.value, this.value.trim());
    });

    searchType.addEventListener("change", function(){
      renderDashboard(this.value, searchInput.value.trim());
    });
  </script>
  <script>
    fetch("sidebar.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("sidebar").innerHTML = data;
      });
  </script>
</body>
</html>
